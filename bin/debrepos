#!/bin/bash
include() { true; }
source $(dirname $0)/../src/bashlibs-base/lib/header.sh
source $(dirname $0)/../src/bashlibs-colors/lib/colors.sh
source $(dirname $0)/../src/bashlibs-verbose/lib/verbose.sh
readonly REPOSITORY_DIR=$1

[[ -z $REPOSITORY_DIR ]] \
    && eexit "$0 <repository dir>"

generate_index() {
    local index_type=$1 # binary, source
    local index_name=$2 # Packages, Sources

    vinfo "Generating $index_type index"

    if [[ -d $index_type ]] 
    then
        dpkg-scanpackages $index_type /dev/null \
            | gzip -9c > $index_type/$index_name.gz
    else
        vwarning "$index_type dir does not exist. I'm not generating index for it!"
    fi

}

generate_binary_index() {
    generate_index binary Packages
}

generate_sources_index() {
    generate_index source Sources
}

main() {
    cd $REPOSITORY_DIR
    generate_binary_index
    generate_sources_index
}
main

# took from http://linux.koolsolutions.com/2009/09/21/howto-create-your-own-local-debian-repository/
