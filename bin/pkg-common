#!/bin/bash

package_source_dir() {
    local dir=$(echo $(args) | awk '{print $1}')

    echo $dir \
        | grep -q '^/' \
        && echo $dir \
        || echo $(working_directory)/$dir
}

cmake_project_name() {
	grep -i "project" $(package_source_dir)/CMakeLists.txt \
		| head -1 \
		| cut -d '(' -f 2 | cut -d ')' -f 1 \
		| tr ' ' '.'
}

tmp_dir() {
    echo /tmp/$(progname)
}

check_source_dir() {
    [[ ! -f $(package_source_dir)/CMakeLists.txt ]] \
        && echo "You need to provide source dir" \
        && exit 1

    [[ ! -d $(package_source_dir) ]] \
        && echo "\"$(args)\": is not a directory!" \
        && exit 1
}

create_dir_if_needed() {
    local dir=$1

    [[ -d $dir ]] \
        || mkdir -p $dir

    readlink -m $dir
}

app_version() {
	cat $(package_source_dir)/version
}

gen_changelog() {
	cd $(package_source_dir)
	git --no-pager log . > ChangeLog
	cd - > /dev/null 2>&1
}

print_ruler() {
    local sign=${1:-'*'}
    local length=${2:-80}

    printf "${sign}%.0s" $(eval echo {1..$length})
    echo
}

gap() {
    local length=$1

    printf " %.0s" $(eval echo {1..$length})
}

print_header() {
    local package_name=$1
    local length=${#package_name}
    local side=$(((80 - length)/2 - 1))
    local sign='*'


    color blue
    echo
    print_ruler "$sign" 80
    echo -n "$sign"
    gap $side
    color yellow
    echo -n $package_name
    color blue
    gap $side
    echo -n "$sign"
    echo
    print_ruler "$sign" 80
    echo
    no_color

}
