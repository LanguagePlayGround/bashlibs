#!/bin/bash
include() { true; }
source $(dirname $0)/../src/bashlibs-base/lib/header.sh
source $(dirname $0)/../src/bashlibs-colors/lib/colors.sh
source $(dirname $0)/../src/bashlibs-verbose/lib/verbose.sh
source $(progdir)/debrepos-common
source $(progdir)/pkg-common
readonly HOST=$1

host() {
    echo $HOST
}

print_ruler() {
    local sign=${1:-'*'}
    local length=${2:-80}

    printf "${sign}%.0s" $(eval echo {1..$length})
    echo
}

gap() {
    local length=$1

    printf " %.0s" $(eval echo {1..$length})
}

print_header() {
    local package_name=$1
    local length=${#package_name}
    local side=$(((80 - length)/2 - 1))
    local sign='*'


    color blue
    echo
    print_ruler "$sign" 80
    echo -n "$sign"
    gap $side
    color yellow
    echo -n $package_name
    color blue
    gap $side
    echo -n "$sign"
    echo
    print_ruler "$sign" 80
    echo
    no_color

}

create_package() {
    local package_name=$1

    print_header $package_name

    $(progdir)/gendeb \
        src/$package_name \
        $(host)
}

remove_package() {
    local package_name=$1

    ssh root@$(host) -- dpkg --purge --force-depends $package_name
}

main() {
    create_package cmake-macros
    create_package bashlibs-cmake-macros
    create_package bashlibs-base
    create_package bashlibs-shunit2-enhancements
    create_package bashlibs-code-clarity
    create_package bashlibs-colors
    create_package bashlibs-verbose
    create_package bashlibs-utils
    create_package bashlibs-file-manipulations
    create_package bashlibs-grub
    create_package bashlibs-initramfs
    create_package bashlibs-os-detection
    create_package bashlibs-usage
    create_repository
}
main
